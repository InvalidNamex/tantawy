{% extends 'base.html' %}
{% block content %}
<style>
    .report-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .report-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 600;
    }
    
    .customer-selector {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
    
    .customer-selector label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .summary-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        border-left: 4px solid #f5576c;
    }
    
    .summary-card h3 {
        font-size: 0.875rem;
        color: #666;
        margin: 0 0 0.5rem 0;
        font-weight: 500;
    }
    
    .summary-card .value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #333;
    }
    
    .summary-card .sub-value {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
    }
    
    .products-table {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .products-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .products-table thead {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }
    
    .products-table th {
        padding: 1rem;
        text-align: right;
        font-weight: 600;
        font-size: 0.95rem;
    }
    
    .products-table td {
        padding: 1rem;
        border-bottom: 1px solid #f1f3f5;
    }
    
    .products-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .products-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .rank-badge {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        text-align: center;
        line-height: 32px;
        font-weight: 700;
        font-size: 0.875rem;
    }
    
    .rank-1 {
        background: linear-gradient(135deg, #FFD700, #FFA500);
        color: white;
    }
    
    .rank-2 {
        background: linear-gradient(135deg, #C0C0C0, #808080);
        color: white;
    }
    
    .rank-3 {
        background: linear-gradient(135deg, #CD7F32, #8B4513);
        color: white;
    }
    
    .rank-other {
        background: #e9ecef;
        color: #666;
    }
    
    .product-name {
        font-weight: 600;
        color: #333;
        font-size: 1.05rem;
    }
    
    .progress-bar-container {
        width: 100%;
        height: 24px;
        background: #e9ecef;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 8px;
    }
    
    .progress-bar-text {
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    
    .empty-state svg {
        width: 120px;
        height: 120px;
        margin-bottom: 1.5rem;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        color: #666;
        font-size: 1.25rem;
    }
    
    .sort-controls {
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
</style>

<div class="report-header">
    <h1>ğŸ“¦ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„</h1>
</div>

<div class="customer-selector">
    <form method="get">
        <label for="customer" class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
        <div class="d-flex gap-2">
            <select name="customer" id="customer" class="form-select" style="max-width: 400px;">
                <option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>
                {% for customer in customers %}
                <option value="{{ customer.id }}" {% if customer.id == selected_customer %}selected{% endif %}>
                    {{ customer.customerVendorName }}
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
    </form>
</div>

{% if selected_customer and product_sales %}
    <div class="summary-cards">
        <div class="summary-card">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
            <div class="value">{{ total_products }}</div>
        </div>
        <div class="summary-card" style="border-left-color: #f093fb;">
            <h3>Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
            <div class="value" style="font-size: 1.2rem;">{{ top_product.product.itemName }}</div>
            <div class="sub-value">{{ top_product.quantity }} ÙˆØ­Ø¯Ø©</div>
        </div>
        <div class="summary-card" style="border-left-color: #28a745;">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
            <div class="value">{{ total_sales|floatformat:2 }} Ø¬.Ù…</div>
        </div>
        <div class="summary-card" style="border-left-color: #17a2b8;">
            <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„ÙƒÙ„ Ù…Ù†ØªØ¬</h3>
            <div class="value">{{ average_per_product|floatformat:2 }} Ø¬.Ù…</div>
        </div>
    </div>

    <div class="sort-controls">
        <form method="get" class="d-flex align-items-center gap-3">
            <input type="hidden" name="customer" value="{{ selected_customer }}">
            <label for="sort" class="form-label mb-0">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
            <select name="sort" id="sort" class="form-select" onchange="this.form.submit()" style="width: auto;">
                <option value="quantity" {% if selected_sort == 'quantity' %}selected{% endif %}>Ø§Ù„ÙƒÙ…ÙŠØ©</option>
                <option value="amount" {% if selected_sort == 'amount' %}selected{% endif %}>Ø§Ù„Ù…Ø¨Ù„Øº</option>
            </select>
        </form>
    </div>

    <div class="products-table">
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th>
                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% for ps in product_sales %}
                <tr>
                    <td>
                        {% if ps.rank == 1 %}
                            <span class="rank-badge rank-1">{{ ps.rank }}</span>
                        {% elif ps.rank == 2 %}
                            <span class="rank-badge rank-2">{{ ps.rank }}</span>
                        {% elif ps.rank == 3 %}
                            <span class="rank-badge rank-3">{{ ps.rank }}</span>
                        {% else %}
                            <span class="rank-badge rank-other">{{ ps.rank }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="product-name">{{ ps.product.itemName }}</div>
                    </td>
                    <td>
                        <div style="font-weight: 600; color: #f5576c;">{{ ps.quantity }}</div>
                    </td>
                    <td>
                        <div>{{ ps.avg_price|floatformat:2 }} Ø¬.Ù…</div>
                    </td>
                    <td>
                        <div style="font-weight: 600; color: #28a745;">{{ ps.total_amount|floatformat:2 }} Ø¬.Ù…</div>
                    </td>
                    <td>
                        <div>{{ ps.invoice_count }}</div>
                    </td>
                    <td style="min-width: 150px;">
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: {{ ps.percentage }}%;">
                                <span class="progress-bar-text">{{ ps.percentage|floatformat:1 }}%</span>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{% elif selected_customer %}
    <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
        </svg>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
        <p style="color: #999;">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù… ÙŠÙ‚Ù… Ø¨Ø´Ø±Ø§Ø¡ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯</p>
    </div>
{% else %}
    <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <h3>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
        <p style="color: #999;">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„</p>
    </div>
{% endif %}

{% endblock %}
