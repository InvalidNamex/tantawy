{% extends 'base.html' %}
{% block content %}
<style>
    .report-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .report-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 600;
    }
    
    .filter-controls {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
    
    .filter-controls label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .summary-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        border-left: 4px solid #4facfe;
    }
    
    .summary-card h3 {
        font-size: 0.875rem;
        color: #666;
        margin: 0 0 0.5rem 0;
        font-weight: 500;
    }
    
    .summary-card .value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #333;
    }
    
    .summary-card .sub-value {
        font-size: 1rem;
        color: #666;
        margin-top: 0.5rem;
    }
    
    .balance-table {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .balance-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .balance-table thead {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }
    
    .balance-table th {
        padding: 1rem;
        text-align: right;
        font-weight: 600;
        font-size: 0.95rem;
    }
    
    .balance-table td {
        padding: 1rem;
        border-bottom: 1px solid #f1f3f5;
    }
    
    .balance-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .balance-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
    }
    
    .status-outstanding {
        background: #fee;
        color: #c00;
    }
    
    .status-credit {
        background: #efe;
        color: #0a0;
    }
    
    .status-paid {
        background: #eee;
        color: #666;
    }
    
    .balance-positive {
        color: #28a745;
        font-weight: 600;
    }
    
    .balance-negative {
        color: #dc3545;
        font-weight: 600;
    }
    
    .balance-zero {
        color: #6c757d;
        font-weight: 600;
    }
    
    .customer-name {
        font-weight: 600;
        color: #333;
        font-size: 1.05rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    
    .empty-state svg {
        width: 120px;
        height: 120px;
        margin-bottom: 1.5rem;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        color: #666;
        font-size: 1.25rem;
    }
    
    /* Mobile Responsive Styles */
    @media (max-width: 991.98px) {
        .report-header {
            padding: 1.5rem;
        }
        
        .report-header h1 {
            font-size: 1.5rem;
        }
        
        .filter-controls form {
            flex-direction: column;
            align-items: stretch !important;
        }
        
        .filter-controls form > div {
            width: 100%;
        }
        
        .filter-controls input,
        .filter-controls select {
            width: 100% !important;
        }
        
        .summary-cards {
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .summary-card {
            padding: 1rem;
        }
        
        .summary-card .value {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 767.98px) {
        .report-header {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .report-header h1 {
            font-size: 1.25rem;
        }
        
        .filter-controls {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-controls .btn-group {
            width: 100%;
            display: flex;
        }
        
        .filter-controls .btn-group .btn {
            flex: 1;
        }
        
        .filter-controls form > div:last-child {
            display: flex;
            gap: 0.5rem;
        }
        
        .filter-controls form > div:last-child .btn {
            flex: 1;
        }
        
        .summary-cards {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .summary-card h3 {
            font-size: 0.75rem;
        }
        
        .summary-card .value {
            font-size: 1.25rem;
        }
        
        .summary-card .sub-value {
            font-size: 0.8rem;
        }
        
        .balance-table {
            border-radius: 8px;
        }
        
        .balance-table th,
        .balance-table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.85rem;
        }
        
        /* Hide less important columns */
        .balance-table th:nth-child(2),
        .balance-table td:nth-child(2),
        .balance-table th:nth-child(3),
        .balance-table td:nth-child(3),
        .balance-table th:nth-child(5),
        .balance-table td:nth-child(5),
        .balance-table th:nth-child(6),
        .balance-table td:nth-child(6) {
            display: none;
        }
        
        .status-badge {
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .customer-name {
            font-size: 0.9rem;
        }
    }
    
    @media (max-width: 575.98px) {
        .summary-cards {
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .summary-card {
            padding: 0.75rem;
            border-radius: 8px;
            border-left-width: 3px;
        }
        
        .summary-card h3 {
            font-size: 0.7rem;
        }
        
        .summary-card .value {
            font-size: 1.1rem;
        }
        
        .summary-card .sub-value {
            font-size: 0.7rem;
        }
        
        .balance-table th,
        .balance-table td {
            padding: 0.5rem;
            font-size: 0.8rem;
        }
        
        .empty-state {
            padding: 2rem 1rem;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
        }
        
        .empty-state h3 {
            font-size: 1rem;
        }
    }
</style>

<div class="report-header">
    <h1>ğŸ’° Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</h1>
</div>

<div class="filter-controls">
    <form method="get" class="d-flex align-items-end gap-3 flex-wrap">
        <div>
            <label for="search" class="form-label mb-1">Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„:</label>
            <input type="text" name="search" id="search" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..." value="{{ search_query }}" style="width: 250px;">
        </div>
        <div>
            <label for="agent" class="form-label mb-1">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:</label>
            <select name="agent" id="agent" class="form-select" style="width: auto;">
                <option value="">Ø§Ù„ÙƒÙ„</option>
                {% for agent in agents %}
                    <option value="{{ agent.id }}" {% if selected_agent == agent.id|stringformat:"i" %}selected{% endif %}>{{ agent.agentName }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="status" class="form-label mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ø±ØµÙŠØ¯:</label>
            <select name="status" id="status" class="form-select" style="width: auto;">
                <option value="all" {% if selected_status == 'all' %}selected{% endif %}>Ø§Ù„ÙƒÙ„</option>
                <option value="outstanding" {% if selected_status == 'outstanding' %}selected{% endif %}>Ù…Ø³ØªØ­Ù‚ ÙÙ‚Ø·</option>
                <option value="credit" {% if selected_status == 'credit' %}selected{% endif %}>Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†</option>
                <option value="paid" {% if selected_status == 'paid' %}selected{% endif %}>Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</option>
            </select>
        </div>
        <div>
            <label for="sort" class="form-label mb-1">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
            <select name="sort" id="sort" class="form-select" style="width: auto;">
                <option value="balance" {% if selected_sort == 'balance' %}selected{% endif %}>Ø§Ù„Ø±ØµÙŠØ¯</option>
                <option value="name" {% if selected_sort == 'name' %}selected{% endif %}>Ø§Ù„Ø§Ø³Ù…</option>
                <option value="last_transaction" {% if selected_sort == 'last_transaction' %}selected{% endif %}>Ø¢Ø®Ø± Ù…Ø¹Ø§Ù…Ù„Ø©</option>
            </select>
        </div>
        <div>
            <label for="direction" class="form-label mb-1">Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</label>
            <div class="btn-group" role="group">
                <input type="radio" class="btn-check" name="direction" id="direction_asc" value="asc" {% if selected_direction == 'asc' %}checked{% endif %} onchange="this.form.submit()">
                <label class="btn btn-outline-primary" for="direction_asc">ØªØµØ§Ø¹Ø¯ÙŠ â†‘</label>
                
                <input type="radio" class="btn-check" name="direction" id="direction_desc" value="desc" {% if selected_direction == 'desc' %}checked{% endif %} onchange="this.form.submit()">
                <label class="btn btn-outline-primary" for="direction_desc">ØªÙ†Ø§Ø²Ù„ÙŠ â†“</label>
            </div>
        </div>
        <div>
            <button type="submit" class="btn btn-primary">ØªØ·Ø¨ÙŠÙ‚</button>
            <a href="{% url 'core:customer_balance' %}" class="btn btn-secondary">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
        </div>
    </form>
</div>

{% if customer_balances and customer_balances|length > 0 %}
    <div class="summary-cards">
        <div class="summary-card" style="border-left-color: #dc3545;">
            <h3>Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù…Ø³ØªØ­Ù‚Ø§Øª</h3>
            <div class="value">{{ outstanding_count }}</div>
            <div class="sub-value">{{ total_outstanding|floatformat:2 }} Ø¬.Ù…</div>
        </div>
        <div class="summary-card" style="border-left-color: #28a745;">
            <h3>Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†</h3>
            <div class="value">{{ credit_count }}</div>
            <div class="sub-value">{{ total_credit|floatformat:2 }} Ø¬.Ù…</div>
        </div>
        <div class="summary-card" style="border-left-color: #6c757d;">
            <h3>Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</h3>
            <div class="value">{{ paid_count }}</div>
        </div>
        <div class="summary-card" style="border-left-color: #17a2b8;">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
            <div class="value">{{ total_customers }}</div>
        </div>
    </div>

    <div class="balance-table">
        <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th class="d-none d-md-table-cell">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</th>
                    <th class="d-none d-md-table-cell">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th>
                    <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                    <th class="d-none d-lg-table-cell">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</th>
                    <th class="d-none d-lg-table-cell">Ø¢Ø®Ø± Ù…Ø¹Ø§Ù…Ù„Ø©</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% for cb in customer_balances %}
                <tr>
                    <td>
                        <div class="customer-name">{{ cb.customer.customerVendorName }}</div>
                    </td>
                    <td class="d-none d-md-table-cell">
                        <div class="balance-positive">{{ cb.total_debit|floatformat:2 }} Ø¬.Ù…</div>
                    </td>
                    <td class="d-none d-md-table-cell">
                        <div class="balance-negative">{{ cb.total_credit|floatformat:2 }} Ø¬.Ù…</div>
                    </td>
                    <td>
                        {% if cb.balance < -0.01 %}
                            <div class="balance-negative">{{ cb.balance|floatformat:2 }} Ø¬.Ù…</div>
                        {% elif cb.balance > 0.01 %}
                            <div class="balance-positive">+{{ cb.balance|floatformat:2 }} Ø¬.Ù…</div>
                        {% else %}
                            <div class="balance-zero">0.00 Ø¬.Ù…</div>
                        {% endif %}
                    </td>
                    <td class="d-none d-lg-table-cell">
                        <div style="font-weight: 600;">{{ cb.transaction_count }}</div>
                    </td>
                    <td class="d-none d-lg-table-cell">
                        {% if cb.last_transaction %}
                            <div style="color: #666;">{{ cb.last_transaction|date:"Y-m-d" }}</div>
                        {% else %}
                            <div style="color: #999;">-</div>
                        {% endif %}
                    </td>
                    <td>
                        {% if cb.status == 'outstanding' %}
                            <span class="status-badge status-outstanding">Ù…Ø³ØªØ­Ù‚</span>
                        {% elif cb.status == 'credit' %}
                            <span class="status-badge status-credit">Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†</span>
                        {% else %}
                            <span class="status-badge status-paid">Ù…Ø¯ÙÙˆØ¹</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>

{% else %}
    <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <p style="color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
    </div>
{% endif %}

{% endblock %}
